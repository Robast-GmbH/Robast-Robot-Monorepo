<?xml version="1.0"?>
<root main_tree_to_execute="MainTree">
    <!-- ////////// -->
    <BehaviorTree ID="MainTree">
        <Fallback>
            <SequenceStar>
                <Control ID="RecoveryNode" name="ComputePathToPoseRecovery" number_of_retries="6">
                    <Action ID="ComputePathToPose" goal="{goal}" path="{path}" planner_id="GridBased"/>
                    <SubTree ID="Recovery" __shared_blackboard="true"/>
                </Control>
                <Action ID="InterimGoalCompAction" interim_pose="{interim_pose}" path="{path}" pose="{goal}" splitter_id=""/>
                <ForceFailure>
                    <Control ID="RecoveryNode" number_of_retries="6">
                        <Control ID="PipelineSequence">
                            <Decorator ID="RateController" hz="1">
                                <Control ID="RecoveryNode" number_of_retries="1">
                                    <Action ID="ComputePathToPose" goal="{interim_pose}" path="{path}" planner_id="GridBased"/>
                                    <Action ID="ClearEntireCostmap" name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
                                </Control>
                            </Decorator>
                            <Control ID="RecoveryNode" number_of_retries="1">
                                <Action ID="FollowPath" controller_id="FollowPath" path="{path}"/>
                                <Action ID="ClearEntireCostmap" name="ClearLocalCostmap" service_name="local_costmap/clear_entirely_local_costmap"/>
                            </Control>
                        </Control>
                        <SubTree ID="Recovery" __shared_blackboard="true"/>
                    </Control>
                </ForceFailure>
            </SequenceStar>
            <Control ID="RecoveryNode" number_of_retries="6">
                <Control ID="PipelineSequence">
                    <Decorator ID="RateController" hz="1">
                        <Control ID="RecoveryNode" number_of_retries="1">
                            <Action ID="ComputePathToPose" goal="{goal}" path="{path}" planner_id="GridBased"/>
                            <Action ID="ClearEntireCostmap" name="ClearGlobalCostmap-Context" service_name="global_costmap/clear_entirely_global_costmap"/>
                        </Control>
                    </Decorator>
                    <Control ID="RecoveryNode" number_of_retries="1">
                        <Action ID="FollowPath" controller_id="FollowPath" path="{path}"/>
                        <Action ID="ClearEntireCostmap" name="ClearLocalCostmap" service_name="local_costmap/clear_entirely_local_costmap"/>
                    </Control>
                </Control>
                <SubTree ID="Recovery" __shared_blackboard="true"/>
            </Control>
        </Fallback>
    </BehaviorTree>
    <!-- ////////// -->
    <BehaviorTree ID="Recovery">
        <ReactiveFallback name="RecoveryFallback">
            <Condition ID="GoalUpdated"/>
            <SequenceStar name="RecoveryActions">
                <Action ID="ClearEntireCostmap" name="ClearLocalCostmap-Subtree" service_name="local_costmap/clear_entirely_local_costmap"/>
                <Action ID="ClearEntireCostmap" name="ClearGlobalCostmap-Subtree" service_name="global_costmap/clear_entirely_global_costmap"/>
                <Action ID="Spin" spin_dist="1.57"/>
                <Action ID="Wait" wait_duration="5"/>
            </SequenceStar>
        </ReactiveFallback>
    </BehaviorTree>
    <!-- ////////// -->
    <TreeNodesModel>
        <Action ID="ClearEntireCostmap">
            <inout_port name="service_name"/>
        </Action>
        <Action ID="ComputePathToPose">
            <inout_port name="goal"/>
            <inout_port name="path"/>
            <inout_port name="planner_id"/>
        </Action>
        <Action ID="FollowPath">
            <inout_port name="controller_id"/>
            <inout_port name="path"/>
        </Action>
        <Condition ID="GoalUpdated"/>
        <Action ID="InterimGoalCompAction">
            <inout_port name="interim_pose"/>
            <inout_port name="path"/>
            <inout_port name="pose"/>
            <inout_port name="splitter_id"/>
        </Action>
        <Control ID="PipelineSequence"/>
        <Decorator ID="RateController">
            <inout_port name="hz"/>
        </Decorator>
        <SubTree ID="Recovery">
            <inout_port name="__shared_blackboard"/>
        </SubTree>
        <Control ID="RecoveryNode">
            <inout_port name="number_of_retries"/>
        </Control>
        <Action ID="Spin">
            <inout_port name="spin_dist"/>
        </Action>
        <Action ID="Wait">
            <inout_port name="wait_duration"/>
        </Action>
    </TreeNodesModel>
    <!-- ////////// -->
</root>

