name: PlatformIO CI

on: [push]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository and submodules
      uses: actions/checkout@v3
      with:
        token: ${{ secrets.SUBMODULE_ACCESS_TOKEN }}
        submodules: 'true'
    - name: Install g++ compiler
      run: |
        sudo apt install build-essential
    - name: Build Tests
      working-directory: libs/can/tests
      run: |
        g++ -std=c++17 -c tests_main.cpp
        g++ -std=c++17 tests_main.o tests_robast_can_msgs.cpp ../src/* -o test_executable -I .. -Wall -Wextra -Wuseless-cast -Wdouble-promotion -Wnull-dereference -Wpedantic -Wshadow -Wnon-virtual-dtor -Wlogical-op  
    - name: Execute Tests
      working-directory: libs/can/tests
      run: |
        ./test_executable
